<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Jump Diffusion Equations Â· DifferentialEquations.jl</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-90474609-3', 'auto');
ga('send', 'pageview');
</script><link rel="canonical" href="https://docs.juliadiffeq.org/stable/tutorials/jump_diffusion/index.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><nav class="toc"><a href="../../"><img class="logo" src="../../assets/logo.png" alt="DifferentialEquations.jl logo"/></a><h1>DifferentialEquations.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../ode_example/">Ordinary Differential Equations</a></li><li><a class="toctext" href="../advanced_ode_example/">Solving Stiff Equations</a></li><li><a class="toctext" href="../sde_example/">Stochastic Differential Equations</a></li><li><a class="toctext" href="../rode_example/">Random Ordinary Differential Equations</a></li><li><a class="toctext" href="../dde_example/">Delay Differential Equations</a></li><li><a class="toctext" href="../dae_example/">Differential Algebraic Equations</a></li><li><a class="toctext" href="../discrete_stochastic_example/">Discrete Stochastic (Gillespie) Equations</a></li><li class="current"><a class="toctext" href>Jump Diffusion Equations</a><ul class="internal"><li><a class="toctext" href="#Defining-a-ConstantRateJump-Problem-1">Defining a ConstantRateJump Problem</a></li><li><a class="toctext" href="#Variable-Rate-Jumps-1">Variable Rate Jumps</a></li><li><a class="toctext" href="#Jump-Diffusion-1">Jump Diffusion</a></li><li><a class="toctext" href="#Coupling-Jump-Problems-1">Coupling Jump Problems</a></li></ul></li><li><a class="toctext" href="../bvp_example/">Boundary Value Problems</a></li><li><a class="toctext" href="../additional/">Additional Tutorials</a></li></ul></li><li><span class="toctext">Basics</span><ul><li><a class="toctext" href="../../basics/overview/">Overview of DifferentialEquations.jl</a></li><li><a class="toctext" href="../../basics/common_solver_opts/">Common Solver Options</a></li><li><a class="toctext" href="../../basics/solution/">Solution Handling</a></li><li><a class="toctext" href="../../basics/plot/">Plot Functions</a></li><li><a class="toctext" href="../../basics/integrator/">Integrator Interface</a></li><li><a class="toctext" href="../../basics/problem/">Problem Interface</a></li><li><a class="toctext" href="../../basics/faq/">Frequently Asked Questions</a></li><li><a class="toctext" href="../../basics/compatibility_chart/">Solver Compatibility Chart</a></li></ul></li><li><span class="toctext">Problem Types</span><ul><li><a class="toctext" href="../../types/discrete_types/">Discrete Problems</a></li><li><a class="toctext" href="../../types/ode_types/">ODE Problems</a></li><li><a class="toctext" href="../../types/dynamical_types/">Dynamical, Hamiltonian and 2nd Order ODE Problems</a></li><li><a class="toctext" href="../../types/split_ode_types/">Split ODE Problems</a></li><li><a class="toctext" href="../../types/steady_state_types/">Steady State Problems</a></li><li><a class="toctext" href="../../types/bvp_types/">BVP Problems</a></li><li><a class="toctext" href="../../types/sde_types/">SDE Problems</a></li><li><a class="toctext" href="../../types/rode_types/">RODE Problems</a></li><li><a class="toctext" href="../../types/dde_types/">DDE Problems</a></li><li><a class="toctext" href="../../types/dae_types/">DAE Problems</a></li><li><a class="toctext" href="../../types/jump_types/">Jump Problems</a></li></ul></li><li><span class="toctext">Solver Algorithms</span><ul><li><a class="toctext" href="../../solvers/discrete_solve/">Discrete Solvers</a></li><li><a class="toctext" href="../../solvers/ode_solve/">ODE Solvers</a></li><li><a class="toctext" href="../../solvers/dynamical_solve/">Dynamical, Hamiltonian, and 2nd Order ODE Solvers</a></li><li><a class="toctext" href="../../solvers/split_ode_solve/">Split ODE Solvers</a></li><li><a class="toctext" href="../../solvers/steady_state_solve/">Steady State Solvers</a></li><li><a class="toctext" href="../../solvers/bvp_solve/">BVP Solvers</a></li><li><a class="toctext" href="../../solvers/jump_solve/">Jump Problem Solvers</a></li><li><a class="toctext" href="../../solvers/sde_solve/">SDE Solvers</a></li><li><a class="toctext" href="../../solvers/rode_solve/">RODE Solvers</a></li><li><a class="toctext" href="../../solvers/dde_solve/">DDE Solvers</a></li><li><a class="toctext" href="../../solvers/dae_solve/">DAE Solvers</a></li><li><a class="toctext" href="../../solvers/benchmarks/">Solver Benchmarks</a></li></ul></li><li><span class="toctext">Additional Features</span><ul><li><a class="toctext" href="../../features/performance_overloads/">DiffEqFunctions (Jacobians, Gradients, etc.) and Jacobian Types</a></li><li><a class="toctext" href="../../features/diffeq_arrays/">DiffEq-Specific Array Types</a></li><li><a class="toctext" href="../../features/diffeq_operator/">DiffEqOperators</a></li><li><a class="toctext" href="../../features/noise_process/">Noise Processes</a></li><li><a class="toctext" href="../../features/linear_nonlinear/">Specifying (Non)Linear Solvers</a></li><li><a class="toctext" href="../../features/callback_functions/">Event Handling and Callback Functions</a></li><li><a class="toctext" href="../../features/callback_library/">Callback Library</a></li><li><a class="toctext" href="../../features/ensemble/">Parallel Ensemble Simulations</a></li><li><a class="toctext" href="../../features/io/">I/O: Saving and Loading Solution Data</a></li><li><a class="toctext" href="../../features/low_dep/">Low Dependency Usage</a></li><li><a class="toctext" href="../../features/progress_bar/">Juno Progress Bar Integration</a></li></ul></li><li><span class="toctext">Analysis Tools</span><ul><li><a class="toctext" href="../../analysis/parameterized_functions/">ParameterizedFunctions</a></li><li><a class="toctext" href="../../analysis/parameter_estimation/">Parameter Estimation and Bayesian Analysis</a></li><li><a class="toctext" href="../../analysis/bifurcation/">Bifurcation Analysis</a></li><li><a class="toctext" href="../../analysis/sensitivity/">Local Sensitivity Analysis (Automatic Differentiation)</a></li><li><a class="toctext" href="../../analysis/global_sensitivity/">Global Sensitivity Analysis</a></li><li><a class="toctext" href="../../analysis/uncertainty_quantification/">Uncertainty Quantification</a></li><li><a class="toctext" href="../../analysis/neural_networks/">Neural Networks</a></li><li><a class="toctext" href="../../analysis/dev_and_test/">Algorithm Development and Testing</a></li></ul></li><li><span class="toctext">Domain Modeling Tools</span><ul><li><a class="toctext" href="../../models/multiscale/">Multi-Scale Models</a></li><li><a class="toctext" href="../../models/physical/">Physical Models</a></li><li><a class="toctext" href="../../models/financial/">Financial Models</a></li><li><a class="toctext" href="../../models/biological/">Chemical Reaction Models</a></li><li><a class="toctext" href="../../models/external_modeling/">External Modeling Packages</a></li></ul></li><li><span class="toctext">APIs</span><ul><li><span class="toctext">DiffEqBase API</span><ul><li><a class="toctext" href="../../apis/diffeqbase/overview/">Overview</a></li><li><a class="toctext" href="../../apis/diffeqbase/functions/">DE functions</a></li><li><a class="toctext" href="../../apis/diffeqbase/problems/">Problems</a></li><li><a class="toctext" href="../../apis/diffeqbase/solutions/">Solutions</a></li><li><a class="toctext" href="../../apis/diffeqbase/solvers/">Solvers</a></li><li><a class="toctext" href="../../apis/diffeqbase/de_types/">DE types</a></li><li><a class="toctext" href="../../apis/diffeqbase/operators/">Operators</a></li><li><a class="toctext" href="../../apis/diffeqbase/callbacks/">Callbacks</a></li><li><a class="toctext" href="../../apis/diffeqbase/interpolation/">Interpolation</a></li><li><a class="toctext" href="../../apis/diffeqbase/ensembles/">Ensembles</a></li><li><a class="toctext" href="../../apis/diffeqbase/data_arrays/">Data arrays</a></li><li><a class="toctext" href="../../apis/diffeqbase/noise/">Noise processes</a></li><li><a class="toctext" href="../../apis/diffeqbase/utility/">Utility</a></li></ul></li><li><a class="toctext" href="../../apis/diffeqbio/">DiffEqBiological.jl API</a></li></ul></li><li><span class="toctext">Extra Details</span><ul><li><a class="toctext" href="../../extras/timestepping/">Timestepping Method Descriptions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorials</li><li><a href>Jump Diffusion Equations</a></li></ul><a class="edit-page" href="https://github.com/JuliaDiffEq/DiffEqDocs.jl/blob/master/docs/src/tutorials/jump_diffusion.md"><span class="fa">ï</span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Jump Diffusion Equations</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Jump-Diffusion-Equations-1" href="#Jump-Diffusion-Equations-1">Jump Diffusion Equations</a></h1><p>This tutorial assumes you have read the <a href="../ode_example">Ordinary Differential Equations tutorial</a>.</p><p>Jump Diffusion equations are stochastic diffeential equations with discontinuous jumps. These can be written as:</p><div>\[\frac{du}{dt} = f(u,p,t) + Î£gáµ¢(u,t)dWâ± + Î£ h_i(u,p,t)N_i(t)\]</div><p>where <span>$N_i$</span> is a Poisson-counter which denotes jumps of size <span>$h_i$</span>. In this tutorial we will show how to solve problems with even more general jumps.</p><h2><a class="nav-anchor" id="Defining-a-ConstantRateJump-Problem-1" href="#Defining-a-ConstantRateJump-Problem-1">Defining a ConstantRateJump Problem</a></h2><p>To start, let&#39;s solve an ODE with constant rate jumps. A jump is defined as being &quot;constant rate&quot; if the rate is only dependent on values from other constant rate jumps, meaning that its rate must not be coupled with time or the solution to the differential equation. However, these types of jumps are cheaper to compute.</p><p>(Note: if your rate is only &quot;slightly&quot; dependent on the solution of the differential equation, then it may be okay to use a <code>ConstantRateJump</code>. Accuracy loss will be related to the percentage that the rate changes over the jump intervals.)</p><p>Let&#39;s solve the following problem. We will have a linear ODE with a Poisson counter of rate 2 (which is the mean and variance), where at each jump the current solution will be halved. To solve this problem, we first define the <code>ODEProblem</code>:</p><pre><code class="language-julia">function f(du,u,p,t)
  du[1] = u[1]
end

prob = ODEProblem(f,[0.2],(0.0,10.0))</code></pre><p>Notice that, even though our equation is on 1 number, we define it using the in-place array form. Variable rate jump equations will require this form. Note that for this tutorial we solve a one-dimensional problem, but the same syntax applies for solving a system of differential equations with multiple jumps.</p><p>Now we define our <code>rate</code> equation for our jump. Since it&#39;s just the constant value 2, we do:</p><pre><code class="language-julia">rate(u,p,t) = 2</code></pre><p>Now we define the <code>affect!</code> of the jump. This is the same as an <code>affect!</code> from a <code>DiscreteCallback</code>, and thus acts directly on the integrator. Therefore, to make it halve the current value of <code>u</code>, we do:</p><pre><code class="language-julia">affect!(integrator) = (integrator.u[1] = integrator.u[1]/2)</code></pre><p>Then we build our jump:</p><pre><code class="language-julia">jump = ConstantRateJump(rate,affect!)</code></pre><p>Next, we extend our <code>ODEProblem</code> to a <code>JumpProblem</code> by attaching the jump:</p><pre><code class="language-julia">jump_prob = JumpProblem(prob,Direct(),jump)</code></pre><p>We can now solve this extended problem using any ODE solver:</p><pre><code class="language-julia">sol = solve(jump_prob,Tsit5())
plot(sol)</code></pre><p><img src="../../assets/constant_rate_jump.png" alt="constant_rate_jump"/></p><h2><a class="nav-anchor" id="Variable-Rate-Jumps-1" href="#Variable-Rate-Jumps-1">Variable Rate Jumps</a></h2><p>Now let&#39;s define a jump which is coupled to the differential equation. Let&#39;s let the rate be the current value of the solution, that is:</p><pre><code class="language-julia">rate(u,p,t) = u[1]</code></pre><p>Using the same <code>affect!</code></p><pre><code class="language-julia">affect!(integrator) = (integrator.u[1] = integrator.u[1]/2)</code></pre><p>we build a <code>VariableRateJump</code>:</p><pre><code class="language-julia">jump = VariableRateJump(rate,affect!)</code></pre><p>To make things interesting, let&#39;s copy this jump:</p><pre><code class="language-julia">jump2 = deepcopy(jump)</code></pre><p>so that way we have two independent jump processes. We now couple these jumps to the <code>ODEProblem</code>:</p><pre><code class="language-julia">jump_prob = JumpProblem(prob,Direct(),jump,jump2)</code></pre><p>which we once again solve using an ODE solver:</p><pre><code class="language-julia">sol = solve(jump_prob,Tsit5())
plot(sol)</code></pre><p><img src="../../assets/variable_rate_jump.png" alt="variable_rate_jump"/></p><h2><a class="nav-anchor" id="Jump-Diffusion-1" href="#Jump-Diffusion-1">Jump Diffusion</a></h2><p>Now we will finally solve the jump diffusion problem. The steps are the same as before, except we now start with a <code>SDEProblem</code> instead of an <code>ODEProblem</code>. Using the same drift function <code>f</code> as before, we add multiplicative noise via:</p><pre><code class="language-julia">function g(du,u,p,t)
  du[1] = u[1]
end

prob = SDEProblem(f,g,[0.2],(0.0,10.0))</code></pre><p>and couple it to the jumps:</p><pre><code class="language-julia">jump_prob = JumpProblem(prob,Direct(),jump,jump2)</code></pre><p>We then solve it using an SDE algorithm:</p><pre><code class="language-julia">sol = solve(jump_prob,SRIW1())
plot(sol)</code></pre><p><img src="../../assets/jump_diffusion.png" alt="jump_diffusion"/></p><h2><a class="nav-anchor" id="Coupling-Jump-Problems-1" href="#Coupling-Jump-Problems-1">Coupling Jump Problems</a></h2><p>In many applications one is interested in coupling two stochastic processes. This has applications in Monte Carlo simulations and sensitivity analysis, for example. Currently, the coupling that is implemented for jump processes is known as the split coupling. The split coupling couples two jump processes by coupling the underlying Poisson processes driving the jump components.</p><p>Suppose <code>prob</code> and <code>prob_control</code> are two problems we wish to couple. Then the coupled problem is obtained by</p><pre><code class="language-julia">prob_coupled =  SplitCoupledJumpProblem(jump_prob,jump_prob_control,Direct(),coupling_map)</code></pre><p>Here, <code>coupling_map</code> specifies which jumps to couple. If <code>(j,i)</code> is in <code>coupling_map</code>, then the <code>i</code>th jump in <code>prob</code> will be coupled to the <code>j</code>th jump in <code>prob_control</code>. Note that currently <code>SplitCoupledJumpProblem</code> is only implemented for constant rate jump problems.</p><p>As an example, consider a doubly stochastic Poisson process, that is, a Poisson process whose rate is itself a stochastic process. In particular, we will take the rate to randomly switch between zero and <code>10</code> at unit rates:</p><pre><code class="language-julia">rate(u,p,t) = u[2]*10
affect!(integrator) = integrator.u[1] += 1.
jump1 = ConstantRateJump(rate,affect!)
rate(u,p,t) = u[2]
affect!(integrator) = (integrator.u[2] -= 1.;integrator.u[3] += 1.)
jump2 = ConstantRateJump(rate,affect!)

rate(u,p,t) = u[3]
affect!(integrator) = (integrator.u[2] += 1.;integrator.u[3] -= 1.)
jump3 = ConstantRateJump(rate,affect!)
prob = DiscreteProblem(u0,tspan)
jump_prob = JumpProblem(prob,Direct(),jump1,jump2,jump3)</code></pre><p>The doubly stochastic poisson process has two sources of randomness: one due to the Poisson process, and another due to random evolution of the rate. This is typical of many multiscale stochastic processes appearing in applications, and it is often useful to compare such a process to one obtained by removing one source of randomness. In present context, this means looking at an ODE with constant jump rates, where the deterministic evolution between jumps is given by the expected value of the Poisson process:</p><pre><code class="language-julia">function f(du,u,p,t)
  du[1] = u[2]*10
  du[2] = 0.
  du[3] = 0.
end
prob_control = ODEProblem(f,u0,tspan)
jump_prob_control = JumpProblem(prob_control,Direct(),jump2,jump3)</code></pre><p>Let&#39;s couple the two problems by coupling the jumps corresponding the switching of the rate:</p><pre><code class="language-julia">coupling_map = [(2,1),(3,2)]
prob_coupled =  SplitCoupledJumpProblem(jump_prob,jump_prob_control,Direct(),coupling_map)</code></pre><p>Now <code>prob_coupled</code> will be dealt with like any other <code>JumpProblem</code>:</p><pre><code class="language-julia">sol = solve(prob_coupled,Tsit5())</code></pre><p><img src="../../assets/splitcoupling.png" alt="jump_diffusion"/></p><footer><hr/><a class="previous" href="../discrete_stochastic_example/"><span class="direction">Previous</span><span class="title">Discrete Stochastic (Gillespie) Equations</span></a><a class="next" href="../bvp_example/"><span class="direction">Next</span><span class="title">Boundary Value Problems</span></a></footer></article></body></html>
